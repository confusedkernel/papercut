{{ define "main" }}
  {{ $taxonomyName := .Data.Plural }}
  {{ if eq $taxonomyName "" }}
    {{ $taxonomyName = lower .Title }}
  {{ end }}

  {{ $normalizedCounts := partial "taxonomy-counts.html" (dict "taxonomyName" $taxonomyName "site" .Site) }}

  <section class="border border-[var(--border)] bg-[var(--bg-alt)] p-5 shadow-[0_14px_24px_-18px_rgba(0,0,0,0.35)] sm:p-6">
    <nav aria-label="Breadcrumb" class="text-sm uppercase tracking-[0.08em] text-[var(--muted)]">
      <span>Taxonomies</span>
      <span class="px-2">&gt;</span>
      <span class="text-[var(--fg)]">{{ .Title }}</span>
    </nav>
    <h1 class="mt-2 text-2xl sm:text-3xl">{{ .Title }}</h1>
  </section>

  <section class="flex flex-col gap-4">
    <ul class="flex flex-wrap gap-2">
      {{ $seenTerms := dict }}
      {{ range .Data.Terms.Alphabetical }}
        {{ $termKey := lower (strings.TrimSpace .Page.Title) }}
        {{ if not (index $seenTerms $termKey) }}
          {{ $seenTerms = merge $seenTerms (dict $termKey true) }}
          {{ $termCount := index $normalizedCounts $termKey | default (len .Page.RegularPages) }}
          <li>
            <a
              class="index-hover border border-[var(--border)] bg-[var(--bg-alt)] px-3 py-1.5 text-[0.72rem] tracking-[0.04em] text-[var(--muted)] hover:text-[var(--fg)]"
              href="{{ printf "/%s/%s/" $taxonomyName ($termKey | urlize) | relURL }}"
            >
              {{ .Page.Title }}<sup class="ml-1 text-[0.6rem]">{{ $termCount }}</sup>
            </a>
          </li>
        {{ end }}
      {{ end }}
    </ul>
  </section>
{{ end }}
