{{ define "main" }}
  {{ $toc := .TableOfContents }}
  {{ $isPost := eq .Section "posts" }}
  {{ $isAboutPage := or (eq .Section "about") (and .File (hasPrefix .File.Path "about/")) }}
  {{ $prev := .PrevInSection }}
  {{ $next := .NextInSection }}
  {{ $aboutAvatar := "" }}
  {{ $aboutAvatarAlt := "" }}
  {{ if $isAboutPage }}
    {{ $aboutAvatar = .Params.avatar | default "" }}
    {{ $aboutAvatarAlt = .Params.avatar_alt | default (.Params.avatarAlt | default (printf "%s avatar" .Title)) }}
  {{ end }}
  {{ if and $toc (eq .Section "posts") }}
    <div class="relative">
      <aside class="toc-outside hidden xl:block">
        <div class="pr-2">
          <p class="mb-3 text-xs uppercase tracking-[0.12em] text-[var(--muted)]">On this page</p>
          <div class="toc">{{ $toc }}</div>
        </div>
      </aside>
      <article class="post-shell border border-[var(--border)] bg-[var(--bg-alt)] p-6">
        <header class="flex flex-col gap-3{{ if $aboutAvatar }} has-about-avatar{{ end }}">
          {{ if .Date.IsZero }}
            <p class="text-[0.7rem] uppercase tracking-[0.12em] text-[var(--muted)]">{{ .Section | title }}</p>
          {{ else }}
            <p class="text-[0.7rem] uppercase tracking-[0.12em] text-[var(--muted)]">
              <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
              {{ with .ReadingTime }}
                <span class="px-2">·</span>
                <span>{{ . }} min read</span>
              {{ end }}
            </p>
          {{ end }}
          <h1 class="text-2xl sm:text-3xl">{{ .Title }}</h1>
          {{ with $aboutAvatar }}
            <figure class="about-avatar">
              <img class="about-avatar__image" src="{{ . | safeURL }}" alt="{{ $aboutAvatarAlt }}" loading="lazy" />
            </figure>
          {{ end }}
          {{ with .Params.description }}
            <p class="text-sm leading-relaxed text-[var(--muted)]">{{ . }}</p>
          {{ end }}
          {{ with .Params.tags }}
            <ul class="flex flex-wrap gap-2 text-[0.7rem] uppercase tracking-[0.08em] text-[var(--muted)]">
              {{ range . }}
                <li>
                  <a class="index-hover border border-[var(--border)] px-2 py-1" href="{{ "tags/" | relURL }}{{ . | urlize }}/">
                    #{{ . }}
                  </a>
                </li>
              {{ end }}
            </ul>
          {{ end }}
        </header>

        <div class="post-content mt-6">
          {{ .Content }}
        </div>
      </article>

      {{ if and $isPost (or $prev $next) }}
        <nav class="mt-4 flex flex-wrap items-stretch gap-3" aria-label="Post navigation">
          {{ with $prev }}
            <a class="index-hover flex w-full min-w-0 flex-col gap-1 border border-[var(--border)] bg-[var(--bg-alt)] p-3 md:w-[calc(50%-0.375rem)]" href="{{ .RelPermalink }}">
              <span class="text-[0.62rem] uppercase tracking-[0.1em] text-[var(--muted)]">Previous post</span>
              <span class="block w-full truncate text-center text-sm leading-snug text-[var(--fg)]" title="{{ .Title }}">{{ .Title }}</span>
            </a>
          {{ end }}

          {{ with $next }}
            <a class="index-hover flex w-full min-w-0 flex-col gap-1 border border-[var(--border)] bg-[var(--bg-alt)] p-3 text-right md:ml-auto md:w-[calc(50%-0.375rem)]" href="{{ .RelPermalink }}">
              <span class="text-[0.62rem] uppercase tracking-[0.1em] text-[var(--muted)]">Next post</span>
              <span class="block w-full truncate text-center text-sm leading-snug text-[var(--fg)]" title="{{ .Title }}">{{ .Title }}</span>
            </a>
          {{ end }}
        </nav>
      {{ end }}
    </div>
  {{ else }}
    <article class="post-shell border border-[var(--border)] bg-[var(--bg-alt)] p-6">
      <header class="flex flex-col gap-3{{ if $aboutAvatar }} has-about-avatar{{ end }}">
        {{ if .Date.IsZero }}
          <p class="text-[0.7rem] uppercase tracking-[0.12em] text-[var(--muted)]">{{ .Section | title }}</p>
        {{ else }}
          <p class="text-[0.7rem] uppercase tracking-[0.12em] text-[var(--muted)]">
            <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
            {{ with .ReadingTime }}
              <span class="px-2">·</span>
              <span>{{ . }} min read</span>
            {{ end }}
          </p>
        {{ end }}
        <h1 class="text-2xl sm:text-3xl">{{ .Title }}</h1>
        {{ with $aboutAvatar }}
          <figure class="about-avatar">
            <img class="about-avatar__image" src="{{ . | safeURL }}" alt="{{ $aboutAvatarAlt }}" loading="lazy" />
          </figure>
        {{ end }}
        {{ with .Params.description }}
          <p class="text-sm leading-relaxed text-[var(--muted)]">{{ . }}</p>
        {{ end }}
        {{ with .Params.tags }}
          <ul class="flex flex-wrap gap-2 text-[0.7rem] uppercase tracking-[0.08em] text-[var(--muted)]">
            {{ range . }}
              <li>
                <a class="index-hover border border-[var(--border)] px-2 py-1" href="{{ "tags/" | relURL }}{{ . | urlize }}/">
                  #{{ . }}
                </a>
              </li>
            {{ end }}
          </ul>
        {{ end }}
      </header>

      <div class="post-content mt-6">
        {{ .Content }}
      </div>
    </article>

    {{ if and $isPost (or $prev $next) }}
      <nav class="mt-4 flex flex-wrap items-stretch gap-3" aria-label="Post navigation">
        {{ with $prev }}
          <a class="index-hover flex w-full min-w-0 flex-col gap-1 border border-[var(--border)] bg-[var(--bg-alt)] p-3 md:w-[calc(50%-0.375rem)]" href="{{ .RelPermalink }}">
            <span class="text-[0.62rem] uppercase tracking-[0.1em] text-[var(--muted)]">Previous post</span>
            <span class="block w-full truncate text-center text-sm leading-snug text-[var(--fg)]" title="{{ .Title }}">{{ .Title }}</span>
          </a>
        {{ end }}

        {{ with $next }}
          <a class="index-hover flex w-full min-w-0 flex-col gap-1 border border-[var(--border)] bg-[var(--bg-alt)] p-3 text-right md:ml-auto md:w-[calc(50%-0.375rem)]" href="{{ .RelPermalink }}">
            <span class="text-[0.62rem] uppercase tracking-[0.1em] text-[var(--muted)]">Next post</span>
            <span class="block w-full truncate text-center text-sm leading-snug text-[var(--fg)]" title="{{ .Title }}">{{ .Title }}</span>
          </a>
        {{ end }}
      </nav>
    {{ end }}
  {{ end }}
{{ end }}
