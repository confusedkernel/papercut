{{ define "main" }}
  {{ $toc := .TableOfContents }}
  {{ $isPost := eq .Section "posts" }}
  {{ $isAboutPage := or (eq .Section "about") (and .File (hasPrefix .File.Path "about/")) }}
  {{ $prev := .PrevInSection }}
  {{ $next := .NextInSection }}
  {{ $aboutAvatar := "" }}
  {{ $aboutAvatarAlt := "" }}
  {{ if $isAboutPage }}
    {{ $aboutAvatar = .Params.avatar | default "" }}
    {{ $aboutAvatarAlt = .Params.avatar_alt | default (.Params.avatarAlt | default (printf "%s avatar" .Title)) }}
  {{ end }}

  {{ $articleCtx := dict "page" . "aboutAvatar" $aboutAvatar "aboutAvatarAlt" $aboutAvatarAlt }}

  {{ if and $toc (eq .Section "posts") }}
    <div class="relative">
      <aside class="toc-outside hidden xl:block">
        <div class="toc-outside__panel">
          <p class="toc-outside__title text-xs uppercase tracking-[0.12em] text-[var(--muted)]">On this page</p>
          <div class="toc">{{ $toc }}</div>
        </div>
      </aside>

      {{ partial "article-single.html" $articleCtx }}

      {{ if $isPost }}
        {{ partial "post-nav.html" (dict "prev" $prev "next" $next) }}
      {{ end }}
    </div>
  {{ else }}
    {{ partial "article-single.html" $articleCtx }}

    {{ if $isPost }}
      {{ partial "post-nav.html" (dict "prev" $prev "next" $next) }}
    {{ end }}
  {{ end }}
{{ end }}
