{{ define "main" }}
  <section class="border border-[var(--border)] bg-[var(--bg-alt)] p-5 shadow-[0_10px_30px_rgba(0,0,0,0.10)] sm:p-6">
    <div class="flex flex-col gap-6 sm:flex-row sm:items-center">
      {{ with .Site.Params.avatar }}
        <div class="shrink-0">
          <img
            class="h-20 w-20 border border-[var(--border)] object-cover"
            src="{{ . | relURL }}"
            alt="{{ $.Site.Title }}"
          />
        </div>
      {{ end }}

      <div class="flex flex-col gap-3">
        <p class="text-xs uppercase tracking-[0.12em] text-[var(--muted)]">
          {{ .Site.Params.tagline | default "Blog" }}
        </p>
        <h1 class="text-3xl sm:text-4xl">{{ .Site.Title }}</h1>
        {{ with .Site.Params.description }}
          <p class="max-w-[58ch] text-sm leading-relaxed text-[var(--muted)]">{{ . }}</p>
        {{ end }}
        {{ with .Site.Params.social }}
          <div class="flex flex-wrap gap-2 text-xs uppercase tracking-[0.08em] text-[var(--muted)]">
            {{ range . }}
              <a
                class="index-hover border border-[var(--border)] px-3 py-2 transition hover:bg-[var(--fg)] hover:text-[var(--bg)]"
                href="{{ .url }}"
                target="_blank"
                rel="noreferrer"
              >
                {{ .name }}
              </a>
            {{ end }}
          </div>
        {{ end }}
      </div>
    </div>
  </section>

  {{ with .Site.Params.announcement }}
    <section class="border border-[var(--border)] bg-[var(--bg-alt)] p-4 text-sm leading-relaxed text-[var(--muted)] shadow-[0_8px_22px_rgba(0,0,0,0.08)]">
      <span class="text-xs uppercase tracking-[0.12em]">Announcement</span>
      <p class="mt-2">{{ . }}</p>
    </section>
  {{ end }}

  {{ $posts := where .Site.RegularPages "Section" "posts" }}
  {{ if not $posts }}
    {{ $posts = .Site.RegularPages }}
  {{ end }}

  {{ if gt (len $posts) 0 }}
    <section class="flex flex-col gap-4">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <h2 class="text-sm uppercase tracking-[0.12em]">Latest posts</h2>
        <a
          class="text-xs uppercase tracking-[0.12em] text-[var(--muted)] underline-offset-4 hover:underline"
          href="{{ (index $posts 0).Section | printf "/%s/" | relURL }}"
        >
          View all
        </a>
      </div>

      <div class="flex flex-wrap items-stretch gap-4">
        {{ range first 4 $posts }}
          <article
            class="interactive-card flex w-full flex-col gap-3 border border-[var(--border)] bg-[var(--bg-alt)] p-4 sm:p-5 md:w-[calc(50%-0.5rem)]"
            data-card-href="{{ .RelPermalink }}"
          >
            <p class="text-[0.7rem] uppercase tracking-[0.12em] text-[var(--muted)]">
              <time datetime="{{ .Date.Format "2006-01-02" }}">
                {{ .Date.Format "Jan 2, 2006" }}
              </time>
            </p>
            <h3 class="text-lg">
              <a class="hover:underline" href="{{ .RelPermalink }}">{{ .Title }}</a>
            </h3>
            {{ with .Params.description }}
              <p class="text-sm leading-relaxed text-[var(--muted)]">{{ . }}</p>
            {{ else }}
              <p class="text-sm leading-relaxed text-[var(--muted)]">{{ .Summary }}</p>
            {{ end }}
            <div class="mt-auto">
              <a
                class="text-xs uppercase tracking-[0.12em] text-[var(--muted)] underline-offset-4 hover:underline"
                href="{{ .RelPermalink }}"
              >
                Read
              </a>
            </div>
          </article>
        {{ end }}
      </div>
    </section>
  {{ end }}

  {{ $projects := where .Site.RegularPages "Section" "projects" }}
  {{ $featuredProjects := where $projects "Params.featured" true }}
  {{ if gt (len $featuredProjects) 0 }}
    <section class="flex flex-col gap-4">
      <div class="flex flex-wrap items-center justify-between gap-3">
        <h2 class="text-sm uppercase tracking-[0.12em]">Featured projects</h2>
        <a
          class="text-xs uppercase tracking-[0.12em] text-[var(--muted)] underline-offset-4 hover:underline"
          href="{{ "/projects/" | relURL }}"
        >
          View all
        </a>
      </div>

      <div class="flex flex-wrap items-stretch gap-4">
        {{ range first 4 $featuredProjects }}
          <article
            class="interactive-card flex w-full flex-col gap-3 border border-[var(--border)] bg-[var(--bg-alt)] p-4 sm:p-5 md:w-[calc(50%-0.5rem)]"
            data-card-href="{{ .RelPermalink }}"
          >
            {{ with .Params.cover }}
              <img
                class="h-40 w-full border border-[var(--border)] object-cover sm:h-44"
                src="{{ . | relURL }}"
                alt=""
              />
            {{ end }}
            <h3 class="text-lg">
              <a class="hover:underline" href="{{ .RelPermalink }}">{{ .Title }}</a>
            </h3>
            {{ with .Params.description }}
              <p class="text-sm leading-relaxed text-[var(--muted)]">{{ . }}</p>
            {{ else }}
              <p class="text-sm leading-relaxed text-[var(--muted)]">{{ .Summary }}</p>
            {{ end }}
          </article>
        {{ end }}
      </div>
    </section>
  {{ end }}

  {{ $categoriesPage := .Site.GetPage "/categories/" }}
  {{ $tagsPage := .Site.GetPage "/tags/" }}
  {{ $archivesPage := .Site.GetPage "/archives/" }}
  {{ $quickLinks := slice }}
  {{ with $categoriesPage }}
    {{ $quickLinks = $quickLinks | append (dict "label" "categories" "url" .RelPermalink) }}
  {{ end }}
  {{ with $tagsPage }}
    {{ $quickLinks = $quickLinks | append (dict "label" "tags" "url" .RelPermalink) }}
  {{ end }}
  {{ with $archivesPage }}
    {{ $quickLinks = $quickLinks | append (dict "label" "archives" "url" .RelPermalink) }}
  {{ end }}
  {{ if gt (len $quickLinks) 0 }}
    <section class="border-t border-[var(--border)] pt-5 text-center">
      <nav aria-label="Browse taxonomy links" class="text-sm tracking-[0.08em] text-[var(--muted)]">
        {{ range $index, $item := $quickLinks }}
          {{ if gt $index 0 }}<span class="px-1.5">/</span>{{ end }}
          <a class="underline-offset-4 transition-colors hover:text-[var(--fg)] hover:underline" href="{{ $item.url }}">{{ $item.label }}</a>
        {{ end }}
      </nav>
    </section>
  {{ end }}
{{ end }}
