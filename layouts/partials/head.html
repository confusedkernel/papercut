<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>
  {{ if .IsHome }}
    {{ .Site.Title }}
  {{ else }}
    {{ .Title }} | {{ .Site.Title }}
  {{ end }}
</title>

{{ $metaDescription := .Params.description | default .Site.Params.description }}
{{ with $metaDescription }}
  <meta name="description" content="{{ . }}" />
{{ end }}

{{ $metaImage := .Params.image | default "" }}
{{ if not $metaImage }}
  {{ with .Params.images }}
    {{ if reflect.IsSlice . }}
      {{ if gt (len .) 0 }}
        {{ $metaImage = index . 0 }}
      {{ end }}
    {{ else }}
      {{ $metaImage = . }}
    {{ end }}
  {{ end }}
{{ end }}
{{ if not $metaImage }}
  {{ $metaImage = .Params.cover | default "" }}
{{ end }}
{{ if not $metaImage }}
  {{ $metaImage = .Site.Params.fallbackImage | default .Site.Params.fallback_image | default "/images/papercut-fallback.svg" }}
{{ end }}
{{ $metaImageURL := "" }}
{{ with $metaImage }}
  {{ if or (hasPrefix . "http://") (hasPrefix . "https://") (hasPrefix . "data:") }}
    {{ $metaImageURL = . }}
  {{ else }}
    {{ $metaImageURL = . | absURL }}
  {{ end }}
{{ end }}

<meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}" />
{{ with $metaDescription }}
  <meta property="og:description" content="{{ . }}" />
{{ end }}
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}" />
<meta property="og:url" content="{{ .Permalink }}" />
{{ with $metaImageURL }}
  <meta property="og:image" content="{{ . }}" />
  <meta name="twitter:image" content="{{ . }}" />
{{ end }}
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}" />
{{ with $metaDescription }}
  <meta name="twitter:description" content="{{ . }}" />
{{ end }}

{{ with .Site.Params.favicon }}
  <link rel="icon" href="{{ . | relURL }}" />
{{ end }}

{{ with .OutputFormats.Get "RSS" }}
  <link rel="alternate" type="{{ .MediaType.Type }}" title="{{ $.Site.Title }}" href="{{ .RelPermalink }}" />
{{ else }}
  {{ with .Site.Home.OutputFormats.Get "RSS" }}
    <link rel="alternate" type="{{ .MediaType.Type }}" title="{{ $.Site.Title }}" href="{{ .RelPermalink }}" />
  {{ end }}
{{ end }}

{{ $latteChroma := resources.Get "css/latte-chroma-style.css" }}
{{ $mochaChroma := resources.Get "css/mocha-chroma-style.css" }}
{{ $tailwindCSS := resources.Get "css/tailwind.css" }}
{{ $themeCSS := slice
  (resources.Get "css/theme/base.css")
  (resources.Get "css/theme/media.css")
  (resources.Get "css/theme/prose.css")
  (resources.Get "css/theme/chrome.css")
  (resources.Get "css/theme/shortcodes-core.css")
  (resources.Get "css/theme/shortcodes-panels.css")
  (resources.Get "css/theme/shortcodes-steps.css")
  (resources.Get "css/theme/toc-timeline.css")
  | resources.Concat "css/theme.css"
}}

<script>
  (function () {
    try {
      var theme = localStorage.getItem("papercut-theme");
      if (theme === null) {
        theme = localStorage.getItem("cardinal-theme");
      }
      if (theme === "light" || theme === "dark") {
        document.documentElement.setAttribute("data-theme", theme);
      } else {
        document.documentElement.removeAttribute("data-theme");
      }
    } catch (e) {
      document.documentElement.removeAttribute("data-theme");
    }
  })();
</script>

<script defer src="{{ "js/utils.js" | relURL }}"></script>
<script defer src="{{ "js/theme-switcher.js" | relURL }}"></script>
<script defer src="{{ "js/code-blocks.js" | relURL }}"></script>
<script defer src="{{ "js/search-toggle.js" | relURL }}"></script>
<script defer src="{{ "js/toc-active.js" | relURL }}"></script>
<script defer src="{{ "js/heading-links.js" | relURL }}"></script>
<script defer src="{{ "js/card-interactions.js" | relURL }}"></script>
<script defer src="{{ "js/header-divider.js" | relURL }}"></script>

<link
  id="chroma-theme"
  rel="stylesheet"
  data-light-href="{{ if $latteChroma }}{{ $latteChroma.RelPermalink }}{{ else }}{{ "css/latte-chroma-style.css" | relURL }}{{ end }}"
  data-dark-href="{{ if $mochaChroma }}{{ $mochaChroma.RelPermalink }}{{ else }}{{ "css/mocha-chroma-style.css" | relURL }}{{ end }}"
  href="{{ if $latteChroma }}{{ $latteChroma.RelPermalink }}{{ else }}{{ "css/latte-chroma-style.css" | relURL }}{{ end }}"
/>
<link rel="stylesheet" href="{{ if $tailwindCSS }}{{ $tailwindCSS.RelPermalink }}{{ else }}{{ "css/tailwind.css" | relURL }}{{ end }}" />
<link rel="stylesheet" href="{{ $themeCSS.RelPermalink }}" />
